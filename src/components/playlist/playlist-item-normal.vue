<template>
    <v-flex xs12 sm4 xl3 flexbox @click="play">
      <v-card>
        <v-card-media
          v-lazy:background-image="song.posterLarge"
          height="220px"
        >
          <v-container grid-list-xs fill-height fluid>
            <v-layout fill-height>
              <v-flex xs12 align-end flexbox>
                <span class="headline white--text" v-text="song.title"></span>
                <br />
                <span class="artist white--text" v-text="song.artist"></span>
              </v-flex>
            </v-layout>
          </v-container>
        </v-card-media>
        <v-card-actions v-bind:class="{ green: isPlaying }">
          <v-spacer></v-spacer>

          <add-to-playlist :song="song"></add-to-playlist>

          <v-btn icon @click.stop="share">
            <v-icon>share</v-icon>
          </v-btn>
          <v-btn icon @click.stop="download">
            <v-icon>file_download</v-icon>
          </v-btn>
          <v-btn icon @click.stop="play">
            <v-icon>play_circle_filled</v-icon>
          </v-btn>
          <v-btn icon @click.stop :href="artistID">
            <v-icon>person</v-icon>
          </v-btn>
          <v-btn icon @click.stop target="_blank" :href="song.mp32">
            <v-icon>open_in_new</v-icon>
          </v-btn>
        </v-card-actions>
      </v-card>
    </v-flex>
</template>
<script>
import addToPlaylist from '@/components/playlist/add-to-playlist.vue'
export default {
  name: 'playlistItemNormal',
  props: ['song', 'index'],
  components: {
    'add-to-playlist': addToPlaylist
  },
  computed: {
    artistID: function () {
      return '#/a/' + this.song.source + '/' + encodeURIComponent(this.song.artist) + '/' + this.song.artistID
    },
    img: function () {
      return this.song.posterLarge
    },
    date: function () {
      // I hate this new date... Volvo please fix.
      return this.$DCAPI.calcDate(new Date(), this.song.created)
    },
    isPlaying: function () {
      return this.$route.path === this.$store.getters.hash && this.song.mp32 === this.$store.getters.current_Playlist[this.$store.getters.index].mp32
    }
  },
  methods: {
    addToPlaylist: function () {
      console.log(123)
    },
    play: function () {
      this.$parent.play(this.index)
    },
    share: function () {
      if (this.$UTILS.isMobile) {
        this.$parent.setIframeSrc('') // double check if this works.
        this.$parent.setIframeSrc('whatsapp://send?text=' + 'http://dc42.netlify.com/' + encodeURIComponent('#/t/' + this.song.source + '/' + this.song.title + '/' + this.song.title + '/' + this.song.trackID))
      } else {
        this.$UTILS.copyToClipboard('dc42.netlify.com/#/t/' + this.song.source + '/' + encodeURIComponent(this.song.artist) + '/' + encodeURIComponent(this.song.title) + '/' + this.song.trackID)
      }
    },
    download: function () {
      this.$DCAPI.getAudio(this.song.mp32, (data) => {
        console.log('got audio link, downloading!')
        this.$UTILS.downloadLink(data)
      })
    }
  }
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style>
.headline, .artist{
    text-shadow: 3px 3px 8px black;
    /* background: rgba(0, 0, 0, .1); */
}
.card__media[lazy=loading] {
  background: center center / cover no-repeat;
}
.card__media[lazy=loaded] {
  background: center center / cover no-repeat;
}
</style>
